import {verifyReceipt} from "./AppleIapCallback";
import assert from "assert";

const sampleReceipt = "MIImagYJKoZIhvcNAQcCoIImWzCCJlcCAQExCzAJBgUrDgMCGgUAMIIWCwYJKoZIhvcNAQcBoIIV/ASCFfgxghX0MAoCAQgCAQEEAhYAMAoCARQCAQEEAgwAMAsCAQECAQEEAwIBADALAgEDAgEBBAMMATEwCwIBCwIBAQQDAgEAMAsCAQ8CAQEEAwIBADALAgEQAgEBBAMCAQAwCwIBGQIBAQQDAgEDMAwCAQoCAQEEBBYCNCswDAIBDgIBAQQEAgIA5TANAgENAgEBBAUCAwIlODANAgETAgEBBAUMAzEuMDAOAgEJAgEBBAYCBFAyNTYwGAIBBAIBAgQQPDYVr7mgt/5X1QLTyzGAijAbAgEAAgEBBBMMEVByb2R1Y3Rpb25TYW5kYm94MBwCAQUCAQEEFLwt9IqNmcNEWKcxrnkBqqKLi0KlMB4CAQwCAQEEFhYUMjAyMS0wNy0wOVQyMDozOTo1NVowHgIBEgIBAQQWFhQyMDEzLTA4LTAxVDA3OjAwOjAwWjAfAgECAgEBBBcMFWlvLmdldHBvbGFyaXplZC5wb2xhcjBHAgEHAgEBBD86maOfIGZsZxAcTE3ZjYcdpZKl6EakEGKi6Es66oJp24Sc0gqB0sQ6k0O2i9+eFrQ65fSuvBGa9xzYlYaED5UwWwIBBgIBAQRTrHbceee8XtsgE2SP8jXlwLvJ5BpjQ+gnIixHXzF9uL8h5C7lvDmld3amE2l9dz+sUMgd1x31HAHF4FR0nVp3rrnjaSIt6807T6hOEVbPmR9h76wwggGEAgERAgEBBIIBejGCAXYwCwICBq0CAQEEAgwAMAsCAgawAgEBBAIWADALAgIGsgIBAQQCDAAwCwICBrMCAQEEAgwAMAsCAga0AgEBBAIMADALAgIGtQIBAQQCDAAwCwICBrYCAQEEAgwAMAwCAgalAgEBBAMCAQEwDAICBqsCAQEEAwIBAzAMAgIGrgIBAQQDAgEAMAwCAgaxAgEBBAMCAQAwDAICBrcCAQEEAwIBADAMAgIGugIBAQQDAgEAMBICAgavAgEBBAkCBwONfqiVwvAwFAICBqYCAQEECwwJcGxhbl9wbHVzMBsCAganAgEBBBIMEDEwMDAwMDA4Mzg5MTU5ODEwGwICBqkCAQEEEgwQMTAwMDAwMDgzODEzNzI0MTAfAgIGqAIBAQQWFhQyMDIxLTA3LTA2VDE2OjAzOjM4WjAfAgIGqgIBAQQWFhQyMDIxLTA3LTA3VDIwOjMyOjAxWjAfAgIGrAIBAQQWFhQyMDIxLTA3LTA2VDE2OjA4OjM4WjCCAYQCARECAQEEggF6MYIBdjALAgIGrQIBAQQCDAAwCwICBrACAQEEAhYAMAsCAgayAgEBBAIMADALAgIGswIBAQQCDAAwCwICBrQCAQEEAgwAMAsCAga1AgEBBAIMADALAgIGtgIBAQQCDAAwDAICBqUCAQEEAwIBATAMAgIGqwIBAQQDAgEDMAwCAgauAgEBBAMCAQAwDAICBrECAQEEAwIBADAMAgIGtwIBAQQDAgEAMAwCAga6AgEBBAMCAQAwEgICBq8CAQEECQIHA41+qJXC8TAUAgIGpgIBAQQLDAlwbGFuX3BsdXMwGwICBqcCAQEEEgwQMTAwMDAwMDgzODkxNjE5MTAbAgIGqQIBAQQSDBAxMDAwMDAwODM4MTM3MjQxMB8CAgaoAgEBBBYWFDIwMjEtMDctMDZUMTY6MDg6MzhaMB8CAgaqAgEBBBYWFDIwMjEtMDctMDdUMjA6MzI6MzVaMB8CAgasAgEBBBYWFDIwMjEtMDctMDZUMTY6MTM6MzhaMIIBhAIBEQIBAQSCAXoxggF2MAsCAgatAgEBBAIMADALAgIGsAIBAQQCFgAwCwICBrICAQEEAgwAMAsCAgazAgEBBAIMADALAgIGtAIBAQQCDAAwCwICBrUCAQEEAgwAMAsCAga2AgEBBAIMADAMAgIGpQIBAQQDAgEBMAwCAgarAgEBBAMCAQMwDAICBq4CAQEEAwIBADAMAgIGsQIBAQQDAgEAMAwCAga3AgEBBAMCAQAwDAICBroCAQEEAwIBADASAgIGrwIBAQQJAgcDjX6olcNkMBQCAgamAgEBBAsMCXBsYW5fcGx1czAbAgIGpwIBAQQSDBAxMDAwMDAwODM4OTE1OTc2MBsCAgapAgEBBBIMEDEwMDAwMDA4MzgxMzcyNDEwHwICBqgCAQEEFhYUMjAyMS0wNy0wNlQxNjoxMzozOFowHwICBqoCAQEEFhYUMjAyMS0wNy0wN1QyMDozMjowMVowHwICBqwCAQEEFhYUMjAyMS0wNy0wNlQxNjoxODozOFowggGEAgERAgEBBIIBejGCAXYwCwICBq0CAQEEAgwAMAsCAgawAgEBBAIWADALAgIGsgIBAQQCDAAwCwICBrMCAQEEAgwAMAsCAga0AgEBBAIMADALAgIGtQIBAQQCDAAwCwICBrYCAQEEAgwAMAwCAgalAgEBBAMCAQEwDAICBqsCAQEEAwIBAzAMAgIGrgIBAQQDAgEAMAwCAgaxAgEBBAMCAQAwDAICBrcCAQEEAwIBADAMAgIGugIBAQQDAgEAMBICAgavAgEBBAkCBwONfqiVw+YwFAICBqYCAQEECwwJcGxhbl9wbHVzMBsCAganAgEBBBIMEDEwMDAwMDA4Mzg5MTYxOTYwGwICBqkCAQEEEgwQMTAwMDAwMDgzODEzNzI0MTAfAgIGqAIBAQQWFhQyMDIxLTA3LTA2VDE2OjE4OjM4WjAfAgIGqgIBAQQWFhQyMDIxLTA3LTA3VDIwOjMyOjM1WjAfAgIGrAIBAQQWFhQyMDIxLTA3LTA2VDE2OjIzOjM4WjCCAYQCARECAQEEggF6MYIBdjALAgIGrQIBAQQCDAAwCwICBrACAQEEAhYAMAsCAgayAgEBBAIMADALAgIGswIBAQQCDAAwCwICBrQCAQEEAgwAMAsCAga1AgEBBAIMADALAgIGtgIBAQQCDAAwDAICBqUCAQEEAwIBATAMAgIGqwIBAQQDAgEDMAwCAgauAgEBBAMCAQAwDAICBrECAQEEAwIBADAMAgIGtwIBAQQDAgEAMAwCAga6AgEBBAMCAQAwEgICBq8CAQEECQIHA41+qJXEdDAUAgIGpgIBAQQLDAlwbGFuX3BsdXMwGwICBqcCAQEEEgwQMTAwMDAwMDgzODkxNTk4MDAbAgIGqQIBAQQSDBAxMDAwMDAwODM4MTM3MjQxMB8CAgaoAgEBBBYWFDIwMjEtMDctMDZUMTY6MjM6MzhaMB8CAgaqAgEBBBYWFDIwMjEtMDctMDdUMjA6MzI6MDFaMB8CAgasAgEBBBYWFDIwMjEtMDctMDZUMTY6Mjg6MzhaMIIBhAIBEQIBAQSCAXoxggF2MAsCAgatAgEBBAIMADALAgIGsAIBAQQCFgAwCwICBrICAQEEAgwAMAsCAgazAgEBBAIMADALAgIGtAIBAQQCDAAwCwICBrUCAQEEAgwAMAsCAga2AgEBBAIMADAMAgIGpQIBAQQDAgEBMAwCAgarAgEBBAMCAQMwDAICBq4CAQEEAwIBADAMAgIGsQIBAQQDAgEAMAwCAga3AgEBBAMCAQAwDAICBroCAQEEAwIBADASAgIGrwIBAQQJAgcDjX6olcUIMBQCAgamAgEBBAsMCXBsYW5fcGx1czAbAgIGpwIBAQQSDBAxMDAwMDAwODM4OTE1OTc4MBsCAgapAgEBBBIMEDEwMDAwMDA4MzgxMzcyNDEwHwICBqgCAQEEFhYUMjAyMS0wNy0wNlQxNjoyODozOFowHwICBqoCAQEEFhYUMjAyMS0wNy0wN1QyMDozMjowMVowHwICBqwCAQEEFhYUMjAyMS0wNy0wNlQxNjozMzozOFowggGEAgERAgEBBIIBejGCAXYwCwICBq0CAQEEAgwAMAsCAgawAgEBBAIWADALAgIGsgIBAQQCDAAwCwICBrMCAQEEAgwAMAsCAga0AgEBBAIMADALAgIGtQIBAQQCDAAwCwICBrYCAQEEAgwAMAwCAgalAgEBBAMCAQEwDAICBqsCAQEEAwIBAzAMAgIGrgIBAQQDAgEAMAwCAgaxAgEBBAMCAQAwDAICBrcCAQEEAwIBADAMAgIGugIBAQQDAgEAMBICAgavAgEBBAkCBwONfqiVxY0wFAICBqYCAQEECwwJcGxhbl9wbHVzMBsCAganAgEBBBIMEDEwMDAwMDA4NDAxMDk5NzUwGwICBqkCAQEEEgwQMTAwMDAwMDgzODEzNzI0MTAfAgIGqAIBAQQWFhQyMDIxLTA3LTA5VDE2OjEyOjQ1WjAfAgIGqgIBAQQWFhQyMDIxLTA3LTA5VDE2OjEyOjQ3WjAfAgIGrAIBAQQWFhQyMDIxLTA3LTA5VDE2OjE3OjQ1WjCCAYQCARECAQEEggF6MYIBdjALAgIGrQIBAQQCDAAwCwICBrACAQEEAhYAMAsCAgayAgEBBAIMADALAgIGswIBAQQCDAAwCwICBrQCAQEEAgwAMAsCAga1AgEBBAIMADALAgIGtgIBAQQCDAAwDAICBqUCAQEEAwIBATAMAgIGqwIBAQQDAgEDMAwCAgauAgEBBAMCAQAwDAICBrECAQEEAwIBADAMAgIGtwIBAQQDAgEAMAwCAga6AgEBBAMCAQAwEgICBq8CAQEECQIHA41+qJdi+TAUAgIGpgIBAQQLDAlwbGFuX3BsdXMwGwICBqcCAQEEEgwQMTAwMDAwMDg0MDExMTQyMTAbAgIGqQIBAQQSDBAxMDAwMDAwODM4MTM3MjQxMB8CAgaoAgEBBBYWFDIwMjEtMDctMDlUMTY6MTc6NDVaMB8CAgaqAgEBBBYWFDIwMjEtMDctMDlUMTY6MTY6NTdaMB8CAgasAgEBBBYWFDIwMjEtMDctMDlUMTY6MjI6NDVaMIIBhAIBEQIBAQSCAXoxggF2MAsCAgatAgEBBAIMADALAgIGsAIBAQQCFgAwCwICBrICAQEEAgwAMAsCAgazAgEBBAIMADALAgIGtAIBAQQCDAAwCwICBrUCAQEEAgwAMAsCAga2AgEBBAIMADAMAgIGpQIBAQQDAgEBMAwCAgarAgEBBAMCAQMwDAICBq4CAQEEAwIBADAMAgIGsQIBAQQDAgEAMAwCAga3AgEBBAMCAQAwDAICBroCAQEEAwIBADASAgIGrwIBAQQJAgcDjX6ol2NHMBQCAgamAgEBBAsMCXBsYW5fcGx1czAbAgIGpwIBAQQSDBAxMDAwMDAwODQwMTEyMDczMBsCAgapAgEBBBIMEDEwMDAwMDA4MzgxMzcyNDEwHwICBqgCAQEEFhYUMjAyMS0wNy0wOVQxNjoyMjo0NVowHwICBqoCAQEEFhYUMjAyMS0wNy0wOVQxNjoyMTo1MFowHwICBqwCAQEEFhYUMjAyMS0wNy0wOVQxNjoyNzo0NVowggGEAgERAgEBBIIBejGCAXYwCwICBq0CAQEEAgwAMAsCAgawAgEBBAIWADALAgIGsgIBAQQCDAAwCwICBrMCAQEEAgwAMAsCAga0AgEBBAIMADALAgIGtQIBAQQCDAAwCwICBrYCAQEEAgwAMAwCAgalAgEBBAMCAQEwDAICBqsCAQEEAwIBAzAMAgIGrgIBAQQDAgEAMAwCAgaxAgEBBAMCAQAwDAICBrcCAQEEAwIBADAMAgIGugIBAQQDAgEAMBICAgavAgEBBAkCBwONfqiXY6wwFAICBqYCAQEECwwJcGxhbl9wbHVzMBsCAganAgEBBBIMEDEwMDAwMDA4NDAxMTMyNDkwGwICBqkCAQEEEgwQMTAwMDAwMDgzODEzNzI0MTAfAgIGqAIBAQQWFhQyMDIxLTA3LTA5VDE2OjI3OjQ1WjAfAgIGqgIBAQQWFhQyMDIxLTA3LTA5VDE2OjI2OjQ5WjAfAgIGrAIBAQQWFhQyMDIxLTA3LTA5VDE2OjMyOjQ1WjCCAYQCARECAQEEggF6MYIBdjALAgIGrQIBAQQCDAAwCwICBrACAQEEAhYAMAsCAgayAgEBBAIMADALAgIGswIBAQQCDAAwCwICBrQCAQEEAgwAMAsCAga1AgEBBAIMADALAgIGtgIBAQQCDAAwDAICBqUCAQEEAwIBATAMAgIGqwIBAQQDAgEDMAwCAgauAgEBBAMCAQAwDAICBrECAQEEAwIBADAMAgIGtwIBAQQDAgEAMAwCAga6AgEBBAMCAQAwEgICBq8CAQEECQIHA41+qJdkDTAUAgIGpgIBAQQLDAlwbGFuX3BsdXMwGwICBqcCAQEEEgwQMTAwMDAwMDg0MDExNDE4OTAbAgIGqQIBAQQSDBAxMDAwMDAwODM4MTM3MjQxMB8CAgaoAgEBBBYWFDIwMjEtMDctMDlUMTY6MzI6NDVaMB8CAgaqAgEBBBYWFDIwMjEtMDctMDlUMTY6MzE6NDhaMB8CAgasAgEBBBYWFDIwMjEtMDctMDlUMTY6Mzc6NDVaMIIBhAIBEQIBAQSCAXoxggF2MAsCAgatAgEBBAIMADALAgIGsAIBAQQCFgAwCwICBrICAQEEAgwAMAsCAgazAgEBBAIMADALAgIGtAIBAQQCDAAwCwICBrUCAQEEAgwAMAsCAga2AgEBBAIMADAMAgIGpQIBAQQDAgEBMAwCAgarAgEBBAMCAQMwDAICBq4CAQEEAwIBADAMAgIGsQIBAQQDAgEAMAwCAga3AgEBBAMCAQAwDAICBroCAQEEAwIBADASAgIGrwIBAQQJAgcDjX6ol2RpMBQCAgamAgEBBAsMCXBsYW5fcGx1czAbAgIGpwIBAQQSDBAxMDAwMDAwODQwMTE0OTYwMBsCAgapAgEBBBIMEDEwMDAwMDA4MzgxMzcyNDEwHwICBqgCAQEEFhYUMjAyMS0wNy0wOVQxNjozNzo0NVowHwICBqoCAQEEFhYUMjAyMS0wNy0wOVQxNjozNjo1MVowHwICBqwCAQEEFhYUMjAyMS0wNy0wOVQxNjo0Mjo0NVowggGEAgERAgEBBIIBejGCAXYwCwICBq0CAQEEAgwAMAsCAgawAgEBBAIWADALAgIGsgIBAQQCDAAwCwICBrMCAQEEAgwAMAsCAga0AgEBBAIMADALAgIGtQIBAQQCDAAwCwICBrYCAQEEAgwAMAwCAgalAgEBBAMCAQEwDAICBqsCAQEEAwIBAzAMAgIGrgIBAQQDAgEAMAwCAgaxAgEBBAMCAQAwDAICBrcCAQEEAwIBADAMAgIGugIBAQQDAgEAMBICAgavAgEBBAkCBwONfqiXZNAwFAICBqYCAQEECwwJcGxhbl9wbHVzMBsCAganAgEBBBIMEDEwMDAwMDA4NDAxNzkwMDcwGwICBqkCAQEEEgwQMTAwMDAwMDgzODEzNzI0MTAfAgIGqAIBAQQWFhQyMDIxLTA3LTA5VDIwOjM5OjUzWjAfAgIGqgIBAQQWFhQyMDIxLTA3LTA5VDIwOjM5OjU1WjAfAgIGrAIBAQQWFhQyMDIxLTA3LTA5VDIwOjQ0OjUzWqCCDmUwggV8MIIEZKADAgECAggO61eH554JjTANBgkqhkiG9w0BAQUFADCBljELMAkGA1UEBhMCVVMxEzARBgNVBAoMCkFwcGxlIEluYy4xLDAqBgNVBAsMI0FwcGxlIFdvcmxkd2lkZSBEZXZlbG9wZXIgUmVsYXRpb25zMUQwQgYDVQQDDDtBcHBsZSBXb3JsZHdpZGUgRGV2ZWxvcGVyIFJlbGF0aW9ucyBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTAeFw0xNTExMTMwMjE1MDlaFw0yMzAyMDcyMTQ4NDdaMIGJMTcwNQYDVQQDDC5NYWMgQXBwIFN0b3JlIGFuZCBpVHVuZXMgU3RvcmUgUmVjZWlwdCBTaWduaW5nMSwwKgYDVQQLDCNBcHBsZSBXb3JsZHdpZGUgRGV2ZWxvcGVyIFJlbGF0aW9uczETMBEGA1UECgwKQXBwbGUgSW5jLjELMAkGA1UEBhMCVVMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQClz4H9JaKBW9aH7SPaMxyO4iPApcQmyz3Gn+xKDVWG/6QC15fKOVRtfX+yVBidxCxScY5ke4LOibpJ1gjltIhxzz9bRi7GxB24A6lYogQ+IXjV27fQjhKNg0xbKmg3k8LyvR7E0qEMSlhSqxLj7d0fmBWQNS3CzBLKjUiB91h4VGvojDE2H0oGDEdU8zeQuLKSiX1fpIVK4cCc4Lqku4KXY/Qrk8H9Pm/KwfU8qY9SGsAlCnYO3v6Z/v/Ca/VbXqxzUUkIVonMQ5DMjoEC0KCXtlyxoWlph5AQaCYmObgdEHOwCl3Fc9DfdjvYLdmIHuPsB8/ijtDT+iZVge/iA0kjAgMBAAGjggHXMIIB0zA/BggrBgEFBQcBAQQzMDEwLwYIKwYBBQUHMAGGI2h0dHA6Ly9vY3NwLmFwcGxlLmNvbS9vY3NwMDMtd3dkcjA0MB0GA1UdDgQWBBSRpJz8xHa3n6CK9E31jzZd7SsEhTAMBgNVHRMBAf8EAjAAMB8GA1UdIwQYMBaAFIgnFwmpthhgi+zruvZHWcVSVKO3MIIBHgYDVR0gBIIBFTCCAREwggENBgoqhkiG92NkBQYBMIH+MIHDBggrBgEFBQcCAjCBtgyBs1JlbGlhbmNlIG9uIHRoaXMgY2VydGlmaWNhdGUgYnkgYW55IHBhcnR5IGFzc3VtZXMgYWNjZXB0YW5jZSBvZiB0aGUgdGhlbiBhcHBsaWNhYmxlIHN0YW5kYXJkIHRlcm1zIGFuZCBjb25kaXRpb25zIG9mIHVzZSwgY2VydGlmaWNhdGUgcG9saWN5IGFuZCBjZXJ0aWZpY2F0aW9uIHByYWN0aWNlIHN0YXRlbWVudHMuMDYGCCsGAQUFBwIBFipodHRwOi8vd3d3LmFwcGxlLmNvbS9jZXJ0aWZpY2F0ZWF1dGhvcml0eS8wDgYDVR0PAQH/BAQDAgeAMBAGCiqGSIb3Y2QGCwEEAgUAMA0GCSqGSIb3DQEBBQUAA4IBAQANphvTLj3jWysHbkKWbNPojEMwgl/gXNGNvr0PvRr8JZLbjIXDgFnf4+LXLgUUrA3btrj+/DUufMutF2uOfx/kd7mxZ5W0E16mGYZ2+FogledjjA9z/Ojtxh+umfhlSFyg4Cg6wBA3LbmgBDkfc7nIBf3y3n8aKipuKwH8oCBc2et9J6Yz+PWY4L5E27FMZ/xuCk/J4gao0pfzp45rUaJahHVl0RYEYuPBX/UIqc9o2ZIAycGMs/iNAGS6WGDAfK+PdcppuVsq1h1obphC9UynNxmbzDscehlD86Ntv0hgBgw2kivs3hi1EdotI9CO/KBpnBcbnoB7OUdFMGEvxxOoMIIEIjCCAwqgAwIBAgIIAd68xDltoBAwDQYJKoZIhvcNAQEFBQAwYjELMAkGA1UEBhMCVVMxEzARBgNVBAoTCkFwcGxlIEluYy4xJjAkBgNVBAsTHUFwcGxlIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MRYwFAYDVQQDEw1BcHBsZSBSb290IENBMB4XDTEzMDIwNzIxNDg0N1oXDTIzMDIwNzIxNDg0N1owgZYxCzAJBgNVBAYTAlVTMRMwEQYDVQQKDApBcHBsZSBJbmMuMSwwKgYDVQQLDCNBcHBsZSBXb3JsZHdpZGUgRGV2ZWxvcGVyIFJlbGF0aW9uczFEMEIGA1UEAww7QXBwbGUgV29ybGR3aWRlIERldmVsb3BlciBSZWxhdGlvbnMgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDKOFSmy1aqyCQ5SOmM7uxfuH8mkbw0U3rOfGOAYXdkXqUHI7Y5/lAtFVZYcC1+xG7BSoU+L/DehBqhV8mvexj/avoVEkkVCBmsqtsqMu2WY2hSFT2Miuy/axiV4AOsAX2XBWfODoWVN2rtCbauZ81RZJ/GXNG8V25nNYB2NqSHgW44j9grFU57Jdhav06DwY3Sk9UacbVgnJ0zTlX5ElgMhrgWDcHld0WNUEi6Ky3klIXh6MSdxmilsKP8Z35wugJZS3dCkTm59c3hTO/AO0iMpuUhXf1qarunFjVg0uat80YpyejDi+l5wGphZxWy8P3laLxiX27Pmd3vG2P+kmWrAgMBAAGjgaYwgaMwHQYDVR0OBBYEFIgnFwmpthhgi+zruvZHWcVSVKO3MA8GA1UdEwEB/wQFMAMBAf8wHwYDVR0jBBgwFoAUK9BpR5R2Cf70a40uQKb3R01/CF4wLgYDVR0fBCcwJTAjoCGgH4YdaHR0cDovL2NybC5hcHBsZS5jb20vcm9vdC5jcmwwDgYDVR0PAQH/BAQDAgGGMBAGCiqGSIb3Y2QGAgEEAgUAMA0GCSqGSIb3DQEBBQUAA4IBAQBPz+9Zviz1smwvj+4ThzLoBTWobot9yWkMudkXvHcs1Gfi/ZptOllc34MBvbKuKmFysa/Nw0Uwj6ODDc4dR7Txk4qjdJukw5hyhzs+r0ULklS5MruQGFNrCk4QttkdUGwhgAqJTleMa1s8Pab93vcNIx0LSiaHP7qRkkykGRIZbVf1eliHe2iK5IaMSuviSRSqpd1VAKmuu0swruGgsbwpgOYJd+W+NKIByn/c4grmO7i77LpilfMFY0GCzQ87HUyVpNur+cmV6U/kTecmmYHpvPm0KdIBembhLoz2IYrF+Hjhga6/05Cdqa3zr/04GpZnMBxRpVzscYqCtGwPDBUfMIIEuzCCA6OgAwIBAgIBAjANBgkqhkiG9w0BAQUFADBiMQswCQYDVQQGEwJVUzETMBEGA1UEChMKQXBwbGUgSW5jLjEmMCQGA1UECxMdQXBwbGUgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkxFjAUBgNVBAMTDUFwcGxlIFJvb3QgQ0EwHhcNMDYwNDI1MjE0MDM2WhcNMzUwMjA5MjE0MDM2WjBiMQswCQYDVQQGEwJVUzETMBEGA1UEChMKQXBwbGUgSW5jLjEmMCQGA1UECxMdQXBwbGUgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkxFjAUBgNVBAMTDUFwcGxlIFJvb3QgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDkkakJH5HbHkdQ6wXtXnmELes2oldMVeyLGYne+Uts9QerIjAC6Bg++FAJ039BqJj50cpmnCRrEdCju+QbKsMflZ56DKRHi1vUFjczy8QPTc4UadHJGXL1XQ7Vf1+b8iUDulWPTV0N8WQ1IxVLFVkds5T39pyez1C6wVhQZ48ItCD3y6wsIG9wtj8BMIy3Q88PnT3zK0koGsj+zrW5DtleHNbLPbU6rfQPDgCSC7EhFi501TwN22IWq6NxkkdTVcGvL0Gz+PvjcM3mo0xFfh9Ma1CWQYnEdGILEINBhzOKgbEwWOxaBDKMaLOPHd5lc/9nXmW8Sdh2nzMUZaF3lMktAgMBAAGjggF6MIIBdjAOBgNVHQ8BAf8EBAMCAQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUK9BpR5R2Cf70a40uQKb3R01/CF4wHwYDVR0jBBgwFoAUK9BpR5R2Cf70a40uQKb3R01/CF4wggERBgNVHSAEggEIMIIBBDCCAQAGCSqGSIb3Y2QFATCB8jAqBggrBgEFBQcCARYeaHR0cHM6Ly93d3cuYXBwbGUuY29tL2FwcGxlY2EvMIHDBggrBgEFBQcCAjCBthqBs1JlbGlhbmNlIG9uIHRoaXMgY2VydGlmaWNhdGUgYnkgYW55IHBhcnR5IGFzc3VtZXMgYWNjZXB0YW5jZSBvZiB0aGUgdGhlbiBhcHBsaWNhYmxlIHN0YW5kYXJkIHRlcm1zIGFuZCBjb25kaXRpb25zIG9mIHVzZSwgY2VydGlmaWNhdGUgcG9saWN5IGFuZCBjZXJ0aWZpY2F0aW9uIHByYWN0aWNlIHN0YXRlbWVudHMuMA0GCSqGSIb3DQEBBQUAA4IBAQBcNplMLXi37Yyb3PN3m/J20ncwT8EfhYOFG5k9RzfyqZtAjizUsZAS2L70c5vu0mQPy3lPNNiiPvl4/2vIB+x9OYOLUyDTOMSxv5pPCmv/K/xZpwUJfBdAVhEedNO3iyM7R6PVbyTi69G3cN8PReEnyvFteO3ntRcXqNx+IjXKJdXZD9Zr1KIkIxH3oayPc4FgxhtbCS+SsvhESPBgOJ4V9T0mZyCKM2r3DYLP3uujL/lTaltkwGMzd/c6ByxW69oPIQ7aunMZT7XZNn/Bh1XZp5m5MkL72NVxnn6hUrcbvZNCJBIqxw8dtk2cXmPIS4AXUKqK1drk/NAJBzewdXUhMYIByzCCAccCAQEwgaMwgZYxCzAJBgNVBAYTAlVTMRMwEQYDVQQKDApBcHBsZSBJbmMuMSwwKgYDVQQLDCNBcHBsZSBXb3JsZHdpZGUgRGV2ZWxvcGVyIFJlbGF0aW9uczFEMEIGA1UEAww7QXBwbGUgV29ybGR3aWRlIERldmVsb3BlciBSZWxhdGlvbnMgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkCCA7rV4fnngmNMAkGBSsOAwIaBQAwDQYJKoZIhvcNAQEBBQAEggEACgwncQAKL0CFkEaQOdWEzlLB8F/qcQ75/ZVnCDhW/SVAfgLQW+lEIOBrHW6oF/EZwtR/0Qp3BW9gIRizy0wF0fx+fuWoV9QGbrHUL/pP/YRnliGEbCKZCYrD1rx2va5qJszNTHYpeGzf4QDU7LtZYQHOljAPNR6xS/Z1MfepEofQYR2SSaLpXwi+ZoGQXcrHaN68oVGUP5ow4MfxjsL09iZtF7RSj2tN5lEi54V+Nz4GYb219uRUFXm/2bfbBa3n0Vra9Pm3i3IBa+WXXEAfNw5pg4U8I6hmAApnO93iOXAVnQwgKU5ZSuEx8L1wGr+o7OKoge4AL7L2trKtxRSoxQ==";

describe('AppleIapCallback', function () {

    it('GIVEN a raw receipt THEN Apple servers should return a decoded version of the receipt', async function () {
        const res = await verifyReceipt(sampleReceipt);

        // Chek if the Apple verifyReceipt endpoint returned a "receipt" object as part of its response
        assert.strictEqual(!!res.receipt,
            true,
            'Response from Apple verifyReceipt endpoint expected to return decoded Receipt, instead it returned: ' + res
        );
    });

    it('GIVEN an invalid receipt THEN Apple servers should return an error code', async function () {
        const res = await verifyReceipt("FAKE_RECEIPT_HERE");

        // Apple responds with a generic 21002 error message when the receipt is invalid
        assert.strictEqual(21002,
            res.status,
            'Response from Apple verifyReceipt endpoint expected to return decoded Receipt, instead it returned: ' + res
        );
    });

});
