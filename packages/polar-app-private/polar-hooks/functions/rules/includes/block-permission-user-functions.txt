function hasBlockPermissionUser() {
    return exists(/databases/$(database)/documents/block_permission_user/$(request.auth.uid));
}

function getBlockPermissionUser() {
    return get(/databases/$(database)/documents/block_permission_user/$(request.auth.uid));
}

function hasBlockPermissionRead(block_id, nspace_id) {

    return hasBlockPermissionUser() && (
        getBlockPermissionUser().pages_ro.hasAny([block_id]) ||
        getBlockPermissionUser().nspaces_ro.hasAny([nspace_id]) ||
        getBlockPermissionUser().pages_rw.hasAny([block_id]) ||
        getBlockPermissionUser().nspaces_rw.hasAny([nspace_id])
    );

}

function hasBlockPermissionWrite(block_id, nspace_id) {

    return hasBlockPermissionUser() && (
        getBlockPermissionUser().pages_rw.hasAny([block_id]) ||
        getBlockPermissionUser().nspaces_rw.hasAny([nspace_id])
    );

}
